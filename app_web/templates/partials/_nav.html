<div class="site-brand">
  <a href="/" aria-label="Finance Insights home">Finance Insights</a>
</div>
<nav class="nav-links" aria-label="Primary">
  {% with path=request.path %}
    {% if request.user.is_authenticated %}
      <a class="nav-link" href="/">Home</a>

      {% if path|slice:":11" == '/dashboard/' %}
        <a class="nav-link" href="/dashboard/" aria-current="page">Dashboard</a>
      {% else %}
        <a class="nav-link" href="/dashboard/">Dashboard</a>
      {% endif %}

      {% if path|slice:":8" == '/upload/' %}
        <a class="nav-link" href="/upload/" aria-current="page">Upload</a>
      {% else %}
        <a class="nav-link" href="/upload/">Upload</a>
      {% endif %}

      <div class="nav-user">
        {# Use a simple initials strategy: first two chars of username, uppercased #}
        <button class="avatar-btn" id="avatarBtn" aria-expanded="false" aria-haspopup="true">{{ request.user.username|slice:":2"|upper }}</button>

        <div class="dropdown-menu" id="avatarMenu" role="menu" aria-labelledby="avatarBtn">
          <a href="{% url 'app_web:profile' %}">Profile</a>
          <a href="{% url 'app_web:settings' %}">Settings</a>
          <div class="dropdown-divider"></div>
          <form method="post" action="{% url 'logout' %}">{% csrf_token %}
            <button type="submit" class="nav-link">Log out</button>
          </form>
        </div>
      </div>

    {% else %}
      <a class="nav-link" href="/">Home</a>

      {% if path|slice:":16" == '/accounts/login/' %}
        <a class="nav-link" href="{% url 'login' %}" aria-current="page">Log in</a>
      {% else %}
        <a class="nav-link" href="{% url 'login' %}">Log in</a>
      {% endif %}

      {% if path|slice:":17" == '/accounts/signup/' %}
        <a class="nav-link" href="{% url 'app_web:signup' %}" aria-current="page">Sign up</a>
      {% else %}
        <a class="nav-link" href="{% url 'app_web:signup' %}">Sign up</a>
      {% endif %}
    {% endif %}
  {% endwith %}
</nav>
