<div class="site-brand">
  <a href="/" aria-label="Finance Insights home">Nasheet</a>
</div>
<nav class="nav-links" aria-label="Primary">
  {% with path=request.path %}
    {% if request.user.is_authenticated %}
      <a class="nav-link" href="/">Home</a>

      {% if path|slice:":11" == '/dashboard/' %}
        <a class="nav-link" href="/dashboard/" aria-current="page">Dashboard</a>
      {% else %}
        <a class="nav-link" href="/dashboard/">Dashboard</a>
      {% endif %}

      {% if path|slice:":14" == '/transactions/' %}
        <a class="nav-link" href="/transactions/" aria-current="page">Transactions</a>
      {% else %}
        <a class="nav-link" href="/transactions/">Transactions</a>
      {% endif %}

      {% if path|slice:":9" == '/budgets/' %}
        <a class="nav-link" href="/budgets/" aria-current="page">Budgets</a>
      {% else %}
        <a class="nav-link" href="/budgets/">Budgets</a>
      {% endif %}

      {% if path|slice:":10" == '/projects/' %}
        <a class="nav-link" href="/projects/" aria-current="page">Projects</a>
      {% else %}
        <a class="nav-link" href="/projects/">Projects</a>
      {% endif %}

      {% if path|slice:":10" == '/invoices/' %}
        <a class="nav-link" href="/invoices/" aria-current="page">Invoices</a>
      {% else %}
        <a class="nav-link" href="/invoices/">Invoices</a>
      {% endif %}

      {% if path|slice:":9" == '/reports/' %}
        <a class="nav-link" href="/reports/" aria-current="page">Reports</a>
      {% else %}
        <a class="nav-link" href="/reports/">Reports</a>
      {% endif %}

      {% if path|slice:":9" == '/clients/' %}
        <a class="nav-link" href="/clients/" aria-current="page">Clients</a>
      {% else %}
        <a class="nav-link" href="/clients/">Clients</a>
      {% endif %}

      {% if path|slice:":11" == '/templates/' %}
        <a class="nav-link" href="/templates/" aria-current="page">Templates</a>
      {% else %}
        <a class="nav-link" href="/templates/">Templates</a>
      {% endif %}

      {% if path|slice:":8" == '/upload/' %}
        <a class="nav-link" href="/upload/" aria-current="page">Upload</a>
      {% else %}
        <a class="nav-link" href="/upload/">Upload</a>
      {% endif %}

      <div class="nav-user">
        {# Use a simple initials strategy: first two chars of username, uppercased #}
        <button class="avatar-btn" id="avatarBtn" aria-expanded="false" aria-haspopup="true">{{ request.user.username|slice:":2"|upper }}</button>

        <div class="dropdown-menu" id="avatarMenu" role="menu" aria-labelledby="avatarBtn">
          <div class="dropdown-header">{{ request.user.username }}</div>
          <a href="{% url 'app_web:profile' %}">My Profile</a>

          {% if current_organization %}
            <div class="dropdown-divider"></div>
            <div class="dropdown-header">Organization</div>

            <!-- Organization Switcher -->
            <div class="org-switcher">
              <button class="org-switcher-btn" id="orgSwitcherBtn">
                <span class="org-name">{{ current_organization.name }}</span>
                <svg width="12" height="12" viewBox="0 0 12 12" fill="currentColor">
                  <path d="M3 5L6 8L9 5H3Z"/>
                </svg>
              </button>

              <div class="org-switcher-menu" id="orgSwitcherMenu" style="display:none;">
                {% for membership in user_organizations %}
                  <a href="{% url 'app_web:switch_organization' membership.organization.id %}"
                     class="org-option {% if membership.organization.id == current_organization.id %}active{% endif %}">
                    <div class="org-option-name">{{ membership.organization.name }}</div>
                    <div class="org-option-role">{{ membership.role.name }}</div>
                  </a>
                {% endfor %}
              </div>
            </div>

            <!-- Team Links -->
            <a href="{% url 'app_web:team_overview' %}">Team Dashboard</a>
          {% endif %}

          <div class="dropdown-divider"></div>
          <a href="{% url 'app_web:settings' %}">Settings</a>
          <form method="post" action="{% url 'logout' %}">{% csrf_token %}
            <button type="submit" class="nav-link">Log out</button>
          </form>
        </div>
      </div>

    {% else %}
      <a class="nav-link" href="/">Home</a>
      {# Public pages for anonymous users only (also available in footer) #}
      {% if path|slice:":9" == '/pricing/' %}
        <a class="nav-link" href="/pricing/" aria-current="page">Pricing</a>
      {% else %}
        <a class="nav-link" href="/pricing/">Pricing</a>
      {% endif %}
      {% if path|slice:":6" == '/demo/' %}
        <a class="nav-link" href="/demo/" aria-current="page">Demo</a>
      {% else %}
        <a class="nav-link" href="/demo/">Demo</a>
      {% endif %}
      {% if path|slice:":7" == '/about/' %}
        <a class="nav-link" href="/about/" aria-current="page">About</a>
      {% else %}
        <a class="nav-link" href="/about/">About</a>
      {% endif %}

      {% if path|slice:":16" == '/accounts/login/' %}
        <a class="nav-link" href="{% url 'login' %}" aria-current="page">Log in</a>
      {% else %}
        <a class="nav-link" href="{% url 'login' %}">Log in</a>
      {% endif %}

      {% if path|slice:":17" == '/accounts/signup/' %}
        <a class="nav-link" href="{% url 'app_web:signup' %}" aria-current="page">Sign up</a>
      {% else %}
        <a class="nav-link" href="{% url 'app_web:signup' %}">Sign up</a>
      {% endif %}
    {% endif %}
  {% endwith %}
</nav>
