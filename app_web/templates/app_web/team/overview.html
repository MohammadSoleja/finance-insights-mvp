{% extends "base.html" %}
{% load static %}

{% block title %}{{ title }} - Finance Insights{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'app_web/styles.css' %}">
{% endblock %}

{% block content %}
<div class="wrap">
  <div class="team-layout">
    <!-- Sidebar -->
    <aside class="team-sidebar">
      <h2 class="team-sidebar-title">Team</h2>
      <nav>
        <ul class="team-nav">
          <li class="team-nav-item">
            <a href="{% url 'app_web:team_overview' %}" class="team-nav-link active">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M3 4a1 1 0 011-1h12a1 1 0 011 1v2a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM3 10a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H4a1 1 0 01-1-1v-6zM14 9a1 1 0 00-1 1v6a1 1 0 001 1h2a1 1 0 001-1v-6a1 1 0 00-1-1h-2z"/>
              </svg>
              Overview
            </a>
          </li>
          <li class="team-nav-item">
            <a href="{% url 'app_web:team_members' %}" class="team-nav-link">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z"/>
              </svg>
              Members
            </a>
          </li>
          <li class="team-nav-item">
            <a href="{% url 'app_web:approvals' %}" class="team-nav-link">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
              </svg>
              Approvals
            </a>
          </li>
          <li class="team-nav-item">
            <a href="{% url 'app_web:activity_log' %}" class="team-nav-link">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
              </svg>
              Activity Log
            </a>
          </li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content -->
    <main class="team-main">
      <h1>Team Overview</h1>
      <p style="color: var(--muted); margin-bottom: 2rem;">{{ current_organization.name }}</p>

      <!-- Stats Cards -->
      <div class="team-stats">
        <div class="team-stat-card blue">
          <div class="team-stat-label">Team Members</div>
          <div class="team-stat-value">{{ members_count }}</div>
        </div>
        <div class="team-stat-card green">
          <div class="team-stat-label">Active Roles</div>
          <div class="team-stat-value">{{ roles_count }}</div>
        </div>
        <div class="team-stat-card orange">
          <div class="team-stat-label">Pending Approvals</div>
          <div class="team-stat-value">{{ pending_approvals_count }}</div>
        </div>
        <div class="team-stat-card purple">
          <div class="team-stat-label">Permission Requests</div>
          <div class="team-stat-value">{{ pending_permission_requests_count }}</div>
        </div>
      </div>

      <!-- Active Members -->
      <section style="margin-top: 3rem;">
        <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Active Members</h2>
        <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 1.5rem;">
          {% if active_members %}
            <div style="display: grid; gap: 1rem;">
              {% for member in active_members %}
                <div style="display: flex; align-items: center; gap: 1rem; padding: 0.75rem; background: white; border-radius: var(--radius-sm);">
                  <div class="member-avatar">{{ member.user.username|slice:":2"|upper }}</div>
                  <div style="flex: 1;">
                    <div class="member-name">{{ member.user.get_full_name|default:member.user.username }}</div>
                    <div class="member-email">{{ member.user.email }}</div>
                  </div>
                  <span class="role-badge {% if member.role.is_owner %}owner{% elif member.role.name == 'Admin' %}admin{% else %}viewer{% endif %}">
                    {{ member.role.name }}
                  </span>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p style="color: var(--muted); text-align: center;">No active members</p>
          {% endif %}
        </div>
      </section>

      <!-- Recent Activity -->
      <section style="margin-top: 3rem;">
        <h2 style="font-size: 1.25rem; margin-bottom: 1rem;">Recent Activity</h2>
        <div style="background: var(--bg-secondary); border-radius: var(--radius-md); padding: 1.5rem;">
          {% if recent_activity %}
            <div style="display: grid; gap: 0.5rem;">
              {% for activity in recent_activity %}
                <div class="activity-item" style="border-radius: var(--radius-sm); background: white;">
                  <div class="activity-icon {{ activity.action }}">
                    {% if activity.action == 'create' %}+{% elif activity.action == 'update' %}✎{% elif activity.action == 'delete' %}×{% else %}•{% endif %}
                  </div>
                  <div class="activity-content">
                    <div class="activity-description">{{ activity.description }}</div>
                    <div class="activity-meta">
                      {% if activity.user %}{{ activity.user.username }}{% else %}System{% endif %} •
                      {{ activity.created_at|timesince }} ago
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p style="color: var(--muted); text-align: center;">No recent activity</p>
          {% endif %}
        </div>
      </section>
    </main>
  </div>
</div>
{% endblock %}

