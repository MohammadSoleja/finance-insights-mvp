{% extends "app_web/reports_base.html" %}
{% load humanize currency_tags %}

{% block report_title %}Project Performance{% endblock %}

{% block report_content %}

<!-- Controls in a card for consistency -->
<div class="card" style="margin-bottom: 1rem;">
  <div id="pnl-controls" style="display:flex; gap:.5rem; align-items:center; justify-content:flex-end;">
    <form id="pnl-filter-form" method="get" style="display:inline-flex; gap:.5rem; align-items:center;">
      <input type="text" id="pnl-start" name="start" placeholder="Start date" value="{{ start_date|date:'Y-m-d' }}" class="form-input">
      <input type="text" id="pnl-end" name="end" placeholder="End date" value="{{ end_date|date:'Y-m-d' }}" class="form-input">
      <button class="btn btn-secondary" type="submit">Apply</button>
    </form>

    {% url 'app_web:report_project_performance_download' as download_url %}
    <a class="btn btn-primary" href="{% if start_date and end_date %}{{ download_url }}?start={{ start_date|date:'Y-m-d' }}&end={{ end_date|date:'Y-m-d' }}{% else %}{{ download_url }}{% endif %}">Download PDF</a>
    <button class="btn btn-secondary" id="printBtn">Print</button>
  </div>
</div>

<!-- Blue header with title -->
<div class="pl-header">
  <div class="pl-title" style="font-size:1.15rem;">Project Performance Report</div>
</div>

<div class="card" id="pnl-card">
  <table class="pl-table">
    <colgroup>
      <col style="width:28%;">
      <col style="width:16%;">
      <col style="width:16%;">
      <col style="width:16%;">
      <col style="width:12%;">
      <col style="width:12%;">
    </colgroup>
    <thead>
      <tr>
        <th>Project</th>
        <th class="num">Budget</th>
        <th class="num">Expenses</th>
        <th class="num">Income</th>
        <th class="num">Profit</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for project in project_data %}
      <tr>
        <td>{{ project.name }}</td>
        <td class="num">{% if project.budget %}{% currency_symbol %}{{ project.budget|floatformat:2|intcomma }}{% else %}-{% endif %}</td>
        <td class="num change-down">{% currency_symbol %}{{ project.expenses|floatformat:2|intcomma }}</td>
        <td class="num change-up">{% currency_symbol %}{{ project.income|floatformat:2|intcomma }}</td>
        <td class="num {% if project.profit >= 0 %}change-up{% else %}change-down{% endif %}">{% currency_symbol %}{{ project.profit|floatformat:2|intcomma }}</td>
        <td style="text-transform:capitalize;">{{ project.status }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" style="text-align: center; padding: 2rem; color: #6b7280;">No projects found</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

{% endblock report_content %}


